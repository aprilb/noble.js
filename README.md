# noble.js

NobleHour API Client library for browser-based applications. Distrubuted as a
[Component.js](https://github.com/component/component) component.

## Installation

    $ component install treetopllc/noble.js

## Documentation

This is a general client-side JavaScript API, in the future we will be releasing
this as a Node/NPM module as well.

All instances in the documentation below of a `callback` parameter will be given
the following arguments, unless otherwise specified:

| Parameter | Type                  | Description                           |
| --------- | --------------------- | ------------------------------------- |
| `err`     | `Error`               | The API error (if applicable)         |
| `data`    | `Object`              | The parsed API result (if applicable) |
| `res`     | `SuperAgent.Response` | The response object generated by [SuperAgent](http://visionmedia.github.io/superagent/) |


### Client(url, id, secret) *constructor*

Builds a new instance of the API client for a given url/id/secret combination.

**Returns**: `Client` object instance

| Parameter | Type     | Description   |
| --------- | -------- | ------------- |
| `url`     | `String` | API Base URL  |
| `id`      | `String` | Client ID     |
| `secret`  | `String` | Client Secret |


### Client#url(path)

Constructs a URL for an API call using the configured base URL. This is largely
an internal function.

**Returns**: `String`

| Parameter | Type     | Description               |
| --------- | -------- | ------------------------- |
| `path`    | `String` | Path to some API resource |


### Client#request([method], uri)

Creates a SuperAgent Request object and returns it so it can be further
configured before making the actual request. This is also a largely internal
function.

**Returns**: `SuperAgent.Request` object instance

| Parameter | Type     | Default | Description                        |
| --------- | -------- | ------- | ---------------------------------- |
| `method`  | `String` | `"GET"` | An HTTP verb (`GET`, `POST`, etc.) |
| `uri`     | `String` | `""`    | Will be passed to `Client#url()`   |


### Client#index(callback)

Queries the NobleHour API root, which includes version information.

| Parameter  | Type       | Description |
| ---------- | ---------- | ----------- |
| `callback` | `Function` | *See above* |


### Client#login(username, password, callback)

Performs an API login, which is required for most API calls. Credentials
reflect a NobleHour account only.

| Parameter  | Type       | Description                |
| ---------- | ---------- | -------------------------- |
| `username` | `String`   | NobleHour account username |
| `password` | `String`   | NobleHour account password |
| `callback` | `Function` | *See above*                |


### Client#search(params, callback)

Performs a search via treetopllc/drake, which uses many possible criteria,
including graph traversal, location and full-text indexing.

| Parameter  | Type       | Description                   |
| ---------- | ---------- | ----------------------------- |
| `params`   | `Object`   | *See available options below* |
| `callback` | `Function` | *See above*                   |

**Available Options (params)**

| Parameter | Type      | Default | Description                                         |
| --------- | --------- | ------- | --------------------------------------------------- |
| `geojson` | `Boolean` | `false` | Whether to retrieve data as GeoJSON                 |
| `types`   | `Array`   | `null`  | Entity types (as `String` or `Number`)              |
| `terms`   | `String`  | `""`    | Full-text search terms (e.g. "keywords")            |
| `lat`     | `Number`  | `null`  | Latitude coordinate                                 |
| `lon`     | `Number`  | `null`  | Longitude coordinate                                |
| `limit`   | `Number`  | `null`  | Limit result size (API currently defaults to `200`) |

**Special Instructions for the `types` Parameter**

The `types` parameter is an array of entity types, you can either use a `String`
value (not case-sensitive) or the corresponding `Number` value, here's a table
for reference:

| ID   | Name                  |
| :--: | --------------------- |
| 0    | News                  |
| 1    | Groups                |
| 2    | Organizations         |
| 3    | Opportunities         |
| 4    | Offline Organizations |
| 5    | Events                |
| 6    | Customers             |
| 7    | Users                 |
| 8    | Resources             |

For example, on the Explore interface, we use: `[ 2, 3, 5 ]`, which is the
same as: `[ "organizations", "opportunities", "events" ]`


### Client#mailboxes(callback)

Retrieves a list of available mailboxes from the API.

| Parameter  | Type       | Description |
| ---------- | ---------- | ----------- |
| `callback` | `Function` | *See above* |


### Client#mailbox(id, [query], callback)

Retrieves information about a specific mailbox based on an ID.

| Parameter  | Type       | Description                       |
| ---------- | ---------- | --------------------------------- |
| `id`       | `String`   | Mailbox ID                        |
| `query`    | `Object`   | Additional query-string arguments |
| `callback` | `Function` | *See above*                       |


### Client#mailboxCreate(id, attr, pref, callback)

Creates a new mailbox with the given configuration.

**TODO**: Get PonyExpress documented so we can simply link to that.

| Parameter  | Type       | Description |
| ---------- | ---------- | ----------- |
| `id`       | `String`   | Mailbox ID  |
| `attr`     | `Object`   | Attributes  |
| `pref`     | `Object`   | Preferences |
| `callback` | `Function` | *See above* |


### Client#mailboxPreferences(id, callback)

Retrieve the preferences configuration for a given mailbox. (by it's ID)

| Parameter  | Type       | Description |
| ---------- | ---------- | ----------- |
| `id`       | `String`   | Mailbox ID  |
| `callback` | `Function` | *See above* |


### Client#mailboxUnread(mailbox, alerts, callback)

Mark the specified alerts as unread.

| Parameter  | Type       | Description        |
| ---------- | ---------- | ------------------ |
| `mailbox`  | `String`   | Mailbox ID         |
| `alerts`   | `String`   | Array of Alert IDs |
| `callback` | `Function` | *See above*        |


### Client#mailboxRead(mailbox, alerts, callback)

Mark the specified alerts as read.

| Parameter  | Type       | Description        |
| ---------- | ---------- | ------------------ |
| `mailbox`  | `String`   | Mailbox ID         |
| `alerts`   | `String`   | Array of Alert IDs |
| `callback` | `Function` | *See above*        |



## Developers

### Dependencies

 * [Node.js / NPM](http://nodejs.org/)
 * [GNU Make](http://www.gnu.org/software/make/)
 * [git-flow](https://github.com/nvie/gitflow)

### Make Targets

 * Build: `make`
 * Clean Built Files: `make clean`

Tests _cannot_ be run via the CLI at this time. (some weirdness with PhantomJS
and Cross-Domain Requests) The test runner is available via the browser though,
so start up a web server (the [http-server](https://github.com/nodeapps/http-server)
module is a good example) in the root directory:

    $ http-server -p 3000 /path/to/noble.js

Then, via [http://localhost:3000/test/runner.html](http://localhost:3000/test/runner.html)
you will get the browser test runner.
